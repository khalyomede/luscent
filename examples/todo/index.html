<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List Demo - Luscent</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body data-bs-theme="dark">
    <header class="navbar bg-body-tertiary">
        <nav class="container-fluid">
            <div class="container">
                <div class="row">
                    <div class="col col-6 offset-3">
                        <a class="navbar-brand" href="#">Todo</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <main class="container mt-5">
        <div class="row">
            <div class="col col-6 offset-3">
                <div class="row">
                    <div class="col col-12">
                        <form data-luscent-on-submit="addTask">
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" placeholder="Feed the cat, Do the dishes, ..."
                                    aria-label="Feed the cat, Do the dishes, ..." aria-describedby="button-addon2"
                                    data-luscent-on-input-bind="newTaskTitle" />
                                <button class="btn btn-outline-secondary" type="submit" id="button-addon2">add</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div data-luscent-if="noTasks" data-luscent-template="empty-tasks-disclaimer"></div>
                <div data-luscent-if="someTasks" data-luscent-template="tasks-list"></div>
            </div>
        </div>
    </main>

    <!-- Templates -->
    <template id="empty-tasks-disclaimer">
        <div class="alert alert-secondary" role="alert">
            This is where you tasks will be displayed.
        </div>
    </template>

    <template id="incomplete-tasks">
        <li class="list-group-item d-flex align-items-center gap-3">
            <input class="form-check-input" type="checkbox" value="" id="firstCheckboxStretched">
            <label class="form-check-label flex-grow-1" for="firstCheckboxStretched" data-luscent-value="title"></label>
            <button class="btn btn-sm btn-outline-danger" data-luscent-on-click="deleteTask"
                data-luscent-id="id">delete</button>
        </li>
    </template>

    <template id="tasks-list">
        <div class="row">
            <div class="col col-12">
                <ul class="list-group" data-luscent-for="incompleteTasks" data-luscent-template="incomplete-tasks">
                </ul>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col col-12 text-secondary">
                <span data-luscent-value="numberOfTasks"></span> tasks displayed.
            </div>
        </div>
    </template>

    <script src="index.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const { start } = window.luscent;

            start({
                state: {
                    tasks: [
                        { id: 1, title: "Learn Luscent", completed: false },
                        { id: 2, title: "Build a todo app", completed: false }
                    ],
                    newTaskTitle: ""
                },
                methods: {
                    addTask: (state) => {
                        if (!state.newTaskTitle.trim()) {
                            return state;
                        }

                        return {
                            ...state,
                            tasks: [
                                ...state.tasks,
                                {
                                    id: Date.now(),
                                    title: state.newTaskTitle,
                                    completed: false
                                }
                            ],
                            newTaskTitle: ""
                        };
                    },
                    toggleTask: (state, event) => {
                        const taskId = parseInt(event.target.closest('[data-task-id]')?.getAttribute('data-task-id'));

                        if (!taskId) {
                            return state;
                        }

                        return {
                            ...state,
                            tasks: state.tasks.map(task =>
                                task.id === taskId
                                    ? { ...task, completed: !task.completed }
                                    : task
                            )
                        };
                    },
                    deleteTask: (state, event, id) => {
                        console.log(`User wants to delete task id ${id}`);

                        return {
                            ...state,
                            tasks: state.tasks.filter((task) => task.id != id)
                        };
                    }
                },
                getters: {
                    numberOfTasks: ({ tasks }) => tasks.length
                },
                conditions: {
                    noTasks: ({ tasks }) => tasks.length === 0,
                    someTasks: ({ tasks }) => tasks.length > 0,
                },
                lists: {
                    incompleteTasks: ({ tasks }) => tasks.filter(task => !task.completed),
                    completedTasks: ({ tasks }) => tasks.filter(task => task.completed),
                },
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>