!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).luscent={})}(this,(function(t){"use strict";var e=function(){return e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},e.apply(this,arguments)};function n(t,e,n,r){return new(n||(n=Promise))((function(a,u){function o(t){try{i(r.next(t))}catch(t){u(t)}}function c(t){try{i(r.throw(t))}catch(t){u(t)}}function i(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}i((r=r.apply(t,e||[])).next())}))}function r(t,e){var n,r,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=c(0),o.throw=c(1),o.return=c(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(i){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(u=0)),u;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return u.label++,{value:c[1],done:!1};case 5:u.label++,r=c[1],c=[0];continue;case 7:c=u.ops.pop(),u.trys.pop();continue;default:if(!(a=u.trys,(a=a.length>0&&a[a.length-1])||6!==c[0]&&2!==c[0])){u=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){u.label=c[1];break}if(6===c[0]&&u.label<a[1]){u.label=a[1],a=c;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(c);break}a[2]&&u.ops.pop(),u.trys.pop();continue}c=e.call(t,u)}catch(t){c=[6,t],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,i])}}}function a(t,e){return void 0===e&&(e=document),Array.from(e.querySelectorAll("[".concat(t,"]"))).filter((function(t){return t instanceof HTMLElement}))}function u(t,e){return n(this,arguments,Promise,(function(t,e,n,u){var o,c,i,s,l,f,d;return void 0===n&&(n=document),r(this,(function(r){for(o=0,c=a("data-luscent-value",n),i=0,s=c;i<s.length;i++)if(l=s[i],(u||!l.closest("[data-luscent-for]"))&&(f=l.getAttribute("data-luscent-value"))){if(d=void 0,u&&f in u)d=u[f];else if(e[f])d=e[f](t.state);else{if(!(f in t.state)){console.warn('No getter or state property found for data-luscent-value="'.concat(f,'"'));continue}d=t.state[f]}l instanceof HTMLInputElement?(o+=1,l.value=String(d)):(o+=1,l.textContent=String(d))}return[2,o]}))}))}function o(t,e,n,r){void 0===n&&(n=document);for(var u=0,o=0,c=a("data-luscent-attach",n);o<c.length;o++){var i=c[o],s=i.getAttribute("data-luscent-attach"),l=i.getAttribute("data-luscent-with");if(s&&l){var f=void 0;if(r&&l in r)f=r[l];else if(e[l])f=e[l](t.state);else{if(!(l in t.state)){console.warn('No attribute getter or state property found for data-luscent-with="'.concat(l,'"'));continue}f=t.state[l]}null==f?(u+=1,i.removeAttribute(s)):!0===f?(u+=1,i.setAttribute(s,"")):(u+=1,i.setAttribute(s,String(f)))}}return u}function c(t,e,a,u,o,c){return n(this,arguments,Promise,(function(t,e,n,a,u,o,c){var i,s,l,d,h,v,b,p,m,g,y,w,T,E,L;return void 0===c&&(c=document),r(this,(function(r){switch(r.label){case 0:for(d in i=0,l=[],s=a)l.push(d);h=0,r.label=1;case 1:if(!(h<l.length))return[3,6];if(!((d=l[h])in s))return[3,5];b=function(t,e,n){return void 0===n&&(n=document),Array.from(n.querySelectorAll("[".concat(t,'="').concat(e,'"]'))).filter((function(t){return t instanceof HTMLElement}))}("data-luscent-if",v=d,c),p=a[v](t.state),m=0,g=b,r.label=2;case 2:return m<g.length?(y=g[m],(w=y.dataset.luscentTemplate)&&(T=document.getElementById(w))instanceof HTMLTemplateElement?p&&y.children.length>0?[3,4]:p?(i+=1,y.innerHTML="",E=T.content.cloneNode(!0),i+=1,y.appendChild(E),L=i,[4,f(t,e,n,a,u,o,y)]):(i+=1,y.innerHTML="",[3,4]):[3,4]):[3,5];case 3:i=L+r.sent(),r.label=4;case 4:return m++,[3,2];case 5:return h++,[3,1];case 6:return[2,i]}}))}))}function i(t,e,c,i,s,f){return n(this,arguments,Promise,(function(t,e,n,c,i,s,f){var d,h,v,b,p,m;return void 0===f&&(f=document),r(this,(function(c){switch(c.label){case 0:d=0,h=a("data-luscent-for",f),v=function(a){var c,f,h,v,b,p,m,g,y,w,T;return r(this,(function(E){switch(E.label){case 0:if(!(c=a.dataset.luscentFor)||!i[c])return[2,"continue"];if(!(f=a.dataset.luscentTemplate))return[2,"continue"];if(!((h=document.getElementById(f))instanceof HTMLTemplateElement))return[2,"continue"];v=a.dataset.luscentKey||"id",b=i[c](t.state),p=new Map,Array.from(a.children).forEach((function(t){t instanceof HTMLElement&&t.dataset.luscentId&&p.set(t.dataset.luscentId,t)})),m=new Set,g=function(c){var i,f,b,g,y,w,T,E;return r(this,(function(r){switch(r.label){case 0:return i=String(c[v]),m.add(i),p.has(i)?(f=p.get(i),b=d,[4,u(t,e,f,c)]):[3,3];case 1:return d=b+r.sent(),g=d,[4,o(t,s,f,c)];case 2:return d=g+r.sent(),l(t,n,f),[3,6];case 3:return y=h.content.cloneNode(!0),Array.from(y.children).forEach((function(t){t instanceof HTMLElement&&(t.dataset.luscentId=i)})),d+=1,a.appendChild(y),(w=a.lastElementChild)?(T=d,[4,u(t,e,w,c)]):[3,6];case 4:return d=T+r.sent(),E=d,[4,o(t,s,w,c)];case 5:d=E+r.sent(),l(t,n,w),r.label=6;case 6:return[2]}}))},y=0,w=b,E.label=1;case 1:return y<w.length?(T=w[y],[5,g(T)]):[3,4];case 2:E.sent(),E.label=3;case 3:return y++,[3,1];case 4:return p.forEach((function(t,e){m.has(e)||t.remove()})),[2]}}))},b=0,p=h,c.label=1;case 1:return b<p.length?(m=p[b],[5,v(m)]):[3,4];case 2:c.sent(),c.label=3;case 3:return b++,[3,1];case 4:return[2,d]}}))}))}function s(t,e,u,o){var c=this;void 0===o&&(o=document);for(var i=function(t){if(!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement))return"continue";var e=t.dataset.luscentBind;return e?"true"===t.dataset.luscentBound?"continue":(t.dataset.luscentBound="true",void t.addEventListener("input",(function(){return n(c,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return(n={})[e]=t.value,[4,u(n)];case 1:return r.sent(),[2]}}))}))}))):"continue"},s=0,l=a("data-luscent-bind",o);s<l.length;s++){i(l[s])}}function l(t,e,a){var u=this;void 0===a&&(a=document);for(var o=function(a){if(!(a instanceof HTMLElement))return"continue";if("true"===a.dataset.luscentBound)return"continue";var o=a.dataset.luscentOn,c=a.dataset.luscentTrigger;if(!o||!c||!e[c])return"continue";a.dataset.luscentBound="true",a.addEventListener(o,(function(o){return n(u,void 0,void 0,(function(){var n,u;return r(this,(function(r){switch(r.label){case 0:return"true"===a.dataset.luscentPreventDefault&&o.preventDefault(),n=a.dataset.luscentId||(null===(u=a.closest("[data-luscent-id]"))||void 0===u?void 0:u.getAttribute("data-luscent-id"))||void 0,[4,e[c](t.state,o,n)];case 1:return r.sent(),[2]}}))}))}))},c=0,i=Array.from(a.querySelectorAll("[data-luscent-on][data-luscent-trigger]"));c<i.length;c++){o(i[c])}}function f(t,e,s,l,f,d){return n(this,arguments,Promise,(function(t,e,n,s,l,f,d){var h,v,b,p;return void 0===d&&(d=document),r(this,(function(r){switch(r.label){case 0:return v=h=0,[4,c(t,e,n,s,l,f,d)];case 1:return h=v+r.sent(),b=h,[4,i(t,e,n,s,l,f,d)];case 2:return h=b+r.sent(),p=h,[4,u(t,e,d)];case 3:return h=p+r.sent(),h+=o(t,f,d),h+=function(t,e){void 0===e&&(e=document);for(var n=0,r=0,u=a("data-luscent-bind",e);r<u.length;r++){var o=u[r];if(o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement){var c=o.dataset.luscentBind;if(c&&c in t.state){var i=t.state[c];n+=1,o.value=String(i||"")}}}return n}(t,d),[2,h]}}))}))}var d=function(){var t=(new Date).toISOString().split("T"),e=t[0],n=t[1].split("Z")[0];return"".concat(e," ").concat(n)};t.start=function(t){var a=this,u=t.state||{},o=t.methods||{},c=t.getters||{},i=t.conditions||{},h=t.lists||{},v=t.attributes||{},b=e({debug:{enabled:!1,showRenderCount:!1}},t.options),p={state:u},m=function(t){return n(a,void 0,Promise,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return Object.assign(p.state,t),[4,f(p,c,o,i,h,v)];case 1:return e=n.sent(),b.debug.enabled&&b.debug.showRenderCount&&console.debug("[".concat(d(),"] Luscent Render Count: ").concat(e)),l(p,o,document),s(0,0,m,document),[2]}}))}))};return setTimeout((function(){return n(a,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,f(p,c,o,i,h,v)];case 1:return e.sent(),[4,f(p,c,o,i,h,v)];case 2:return t=e.sent(),b.debug.enabled&&b.debug.showRenderCount&&console.debug("[".concat(d(),"] Luscent Render Count: ").concat(t)),l(p,o,document),s(0,0,m,document),console.log("[".concat(d(),"] Luscent initialized successfully")),[2]}}))}))}),0),{updateState:m}}}));