!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).luscent={})}(this,(function(t){"use strict";function e(t,e,n,r){return new(n||(n=Promise))((function(a,u){function i(t){try{o(r.next(t))}catch(t){u(t)}}function c(t){try{o(r.throw(t))}catch(t){u(t)}}function o(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}o((r=r.apply(t,e||[])).next())}))}function n(t,e){var n,r,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(o){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(u=0)),u;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return u.label++,{value:c[1],done:!1};case 5:u.label++,r=c[1],c=[0];continue;case 7:c=u.ops.pop(),u.trys.pop();continue;default:if(!(a=u.trys,(a=a.length>0&&a[a.length-1])||6!==c[0]&&2!==c[0])){u=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){u.label=c[1];break}if(6===c[0]&&u.label<a[1]){u.label=a[1],a=c;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(c);break}a[2]&&u.ops.pop(),u.trys.pop();continue}c=e.call(t,u)}catch(t){c=[6,t],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,o])}}}function r(t,e){return void 0===e&&(e=document),Array.from(e.querySelectorAll("[".concat(t,"]"))).filter((function(t){return t instanceof HTMLElement}))}function a(t,a){return e(this,arguments,Promise,(function(t,e,a,u){var i,c,o,s,l,f;return void 0===a&&(a=document),n(this,(function(n){for(i=r("data-luscent-value",a),c=0,o=i;c<o.length;c++)if(s=o[c],(u||!s.closest("[data-luscent-for]"))&&(l=s.getAttribute("data-luscent-value"))){if(f=void 0,u&&l in u)f=u[l];else if(e[l])f=e[l](t.state);else{if(!(l in t.state)){console.warn('No getter or state property found for data-luscent-value="'.concat(l,'"'));continue}f=t.state[l]}s instanceof HTMLInputElement?s.value=String(f):s.textContent=String(f)}return[2]}))}))}function u(t,e,n,a){void 0===n&&(n=document);for(var u=0,i=r("data-luscent-attach",n);u<i.length;u++){var c=i[u],o=c.getAttribute("data-luscent-attach"),s=c.getAttribute("data-luscent-with");if(o&&s){var l=void 0;if(a&&s in a)l=a[s];else if(e[s])l=e[s](t.state);else{if(!(s in t.state)){console.warn('No attribute getter or state property found for data-luscent-with="'.concat(s,'"'));continue}l=t.state[s]}null==l?c.removeAttribute(o):!0===l?c.setAttribute(o,""):c.setAttribute(o,String(l))}}}function i(t,r,a,u,i,c){return e(this,arguments,Promise,(function(t,e,r,a,u,i,c){var o,s,f,d,h,v,m,b,p,g,y,w,T;return void 0===c&&(c=document),n(this,(function(n){switch(n.label){case 0:for(f in s=[],o=a)s.push(f);d=0,n.label=1;case 1:if(!(d<s.length))return[3,6];if(!((f=s[d])in o))return[3,5];v=function(t,e,n){return void 0===n&&(n=document),Array.from(n.querySelectorAll("[".concat(t,'="').concat(e,'"]'))).filter((function(t){return t instanceof HTMLElement}))}("data-luscent-if",h=f,c),m=a[h](t.state),b=0,p=v,n.label=2;case 2:return b<p.length?(g=p[b],(y=g.dataset.luscentTemplate)&&(w=document.getElementById(y))instanceof HTMLTemplateElement?(g.innerHTML="",m?(T=w.content.cloneNode(!0),g.appendChild(T),[4,l(t,e,r,a,u,i,g)]):[3,4]):[3,4]):[3,5];case 3:n.sent(),n.label=4;case 4:return b++,[3,2];case 5:return d++,[3,1];case 6:return[2]}}))}))}function c(t,i,c,o,l,f){return e(this,arguments,Promise,(function(t,e,i,c,o,l,f){var d,h,v,m,b;return void 0===f&&(f=document),n(this,(function(c){switch(c.label){case 0:d=r("data-luscent-for",f),h=function(r){var c,f,d,h,v,m,b,p,g,y,w;return n(this,(function(T){switch(T.label){case 0:if(!(c=r.dataset.luscentFor)||!o[c])return[2,"continue"];if(!(f=r.dataset.luscentTemplate))return[2,"continue"];if(!((d=document.getElementById(f))instanceof HTMLTemplateElement))return[2,"continue"];h=r.dataset.luscentKey||"id",v=o[c](t.state),m=new Map,Array.from(r.children).forEach((function(t){t instanceof HTMLElement&&t.dataset.luscentId&&m.set(t.dataset.luscentId,t)})),b=new Set,p=function(c){var o,f,v,p;return n(this,(function(n){switch(n.label){case 0:return o=String(c[h]),b.add(o),m.has(o)?(f=m.get(o),[4,a(t,e,f,c)]):[3,3];case 1:return n.sent(),[4,u(t,l,f,c)];case 2:return n.sent(),s(t,i,f),[3,6];case 3:return v=d.content.cloneNode(!0),Array.from(v.children).forEach((function(t){t instanceof HTMLElement&&(t.dataset.luscentId=o)})),r.appendChild(v),(p=r.lastElementChild)?[4,a(t,e,p,c)]:[3,6];case 4:return n.sent(),[4,u(t,l,p,c)];case 5:n.sent(),s(t,i,p),n.label=6;case 6:return[2]}}))},g=0,y=v,T.label=1;case 1:return g<y.length?(w=y[g],[5,p(w)]):[3,4];case 2:T.sent(),T.label=3;case 3:return g++,[3,1];case 4:return m.forEach((function(t,e){b.has(e)||t.remove()})),[2]}}))},v=0,m=d,c.label=1;case 1:return v<m.length?(b=m[v],[5,h(b)]):[3,4];case 2:c.sent(),c.label=3;case 3:return v++,[3,1];case 4:return[2]}}))}))}function o(t,a,u,i){var c=this;void 0===i&&(i=document);for(var o=function(t){if(!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement))return"continue";var r=t.dataset.luscentBind;return r?"true"===t.dataset.luscentBound?"continue":(t.dataset.luscentBound="true",void t.addEventListener("input",(function(){return e(c,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return(e={})[r]=t.value,[4,u(e)];case 1:return n.sent(),[2]}}))}))}))):"continue"},s=0,l=r("data-luscent-bind",i);s<l.length;s++){o(l[s])}}function s(t,r,a){var u=this;void 0===a&&(a=document);for(var i=function(a){if(!(a instanceof HTMLElement))return"continue";if("true"===a.dataset.luscentBound)return"continue";var i=a.dataset.luscentOn,c=a.dataset.luscentTrigger;if(!i||!c||!r[c])return"continue";a.dataset.luscentBound="true",a.addEventListener(i,(function(i){return e(u,void 0,void 0,(function(){var e,u;return n(this,(function(n){switch(n.label){case 0:return"true"===a.dataset.luscentPreventDefault&&i.preventDefault(),e=a.dataset.luscentId||(null===(u=a.closest("[data-luscent-id]"))||void 0===u?void 0:u.getAttribute("data-luscent-id"))||void 0,[4,r[c](t.state,i,e)];case 1:return n.sent(),[2]}}))}))}))},c=0,o=Array.from(a.querySelectorAll("[data-luscent-on][data-luscent-trigger]"));c<o.length;c++){i(o[c])}}function l(t,o,s,l,f,d){return e(this,arguments,Promise,(function(t,e,o,s,l,f,d){return void 0===d&&(d=document),n(this,(function(n){switch(n.label){case 0:return[4,i(t,e,o,s,l,f,d)];case 1:return n.sent(),[4,c(t,e,o,s,l,f,d)];case 2:return n.sent(),[4,a(t,e,d)];case 3:return n.sent(),u(t,f,d),function(t,e){void 0===e&&(e=document);for(var n=0,a=r("data-luscent-bind",e);n<a.length;n++){var u=a[n];if(u instanceof HTMLInputElement||u instanceof HTMLTextAreaElement){var i=u.dataset.luscentBind;if(i&&i in t.state){var c=t.state[i];u.value=String(c||"")}}}}(t,d),[2]}}))}))}t.start=function(t){var r=this,a=t.state||{},u=t.methods||{},i=t.getters||{},c=t.conditions||{},f=t.lists||{},d=t.attributes||{},h={state:a},v=function(t){return e(r,void 0,Promise,(function(){return n(this,(function(e){switch(e.label){case 0:return Object.assign(h.state,t),[4,l(h,i,u,c,f,d)];case 1:return e.sent(),s(h,u,document),o(0,0,v,document),[2]}}))}))};return setTimeout((function(){return e(r,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,l(h,i,u,c,f,d)];case 1:return t.sent(),s(h,u,document),o(0,0,v,document),console.log("Luscent initialized successfully"),[2]}}))}))}),0),{updateState:v}}}));